<div *ngIf="loading()">🔄 Caricamento documenti...</div>
<div *ngIf="error()">{{ error() }}</div>

<div *ngIf="!loading() && !error()">
  <h2>📁 Documenti nella collezione: {{ collectionId }}</h2>

  <div *ngFor="let doc of documents(); let i = index">
    <div>
      <h3>
        <button (click)="toggleDetails(doc.id)">
          {{ expandedDocs()[doc.id] ? '−' : '+' }}
        </button>
        Documento {{ i + 1 }} - ID: {{ doc.id }}
         <!-- Frecce di spostamento -->
    <ng-container *ngIf="documents().length > 1">
      <button *ngIf="i > 0" (click)="spostaDocumento(doc.id, doc.progr, documents()[i - 1].id, documents()[i - 1].progr)">⬆️</button>
      <button *ngIf="i < documents().length - 1" (click)="spostaDocumento(doc.id, doc.progr, documents()[i + 1].id, documents()[i + 1].progr)">⬇️</button>
    </ng-container>
      </h3>

      <div *ngIf="editingDocId() !== doc.id">
        <button (click)="editDocumentName(doc.id)">✏️ Modifica nome documento</button>
        <button (click)="deleteDocument(doc.id)">🗑️ Cancella</button>
      </div>

      <div *ngIf="editingDocId() === doc.id">
        <input [ngModel]="newDocName()" (ngModelChange)="newDocName.set($event)" />
        <button (click)="saveDocumentName(doc.id)">💾 Salva</button>
      </div>
    </div>

    <!-- Dettagli del documento -->
    <div *ngIf="expandedDocs()[doc.id]" style="margin-top: 10px;">
      <table border="1" style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr>
            <th>Titolo</th>
            <th>Notizia</th>
            <th>Azioni</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let campo of doc.dati">
            <td>{{ campo.chiave }}</td>
            <td [innerHTML]="campo.valore"></td>
            <td>
              <button (click)="updateRecord(doc.id, campo.chiave, campo.valore)">🛠️ Modifica record</button>
              <button (click)="deleteRecord(doc.id, campo.chiave, campo.valore)">🗑️ Cancella record</button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Aggiunta nuovo campo -->
      <div style="margin-top: 10px;">
        <label><strong>Nuovo campo:</strong></label><br>
        <input [ngModel]="getKey(doc.id)" (ngModelChange)="updateKey(doc.id, $event)" placeholder="Titolo" />
        <ngx-editor-menu [editor]="editor" [toolbar]="toolbar"></ngx-editor-menu>
<ngx-editor
  [editor]="editor"
  
  [ngModel]="getValue(doc.id)"
  (ngModelChange)="updateValue(doc.id, $event)"
  placeholder="Scrivi qui..."
></ngx-editor>

        <button (click)="addFieldToDocument(doc.id)">➕ Aggiungi campo</button>
      </div>
    </div>

    <hr />
  </div>

  <button (click)="addDocument()">➕ Aggiungi documento</button>
  <button (click)="loadPicture()">🖼️ Carica immagine</button>

  <app-add-document-modal
    *ngIf="showModalNewDoc()"
    [collectionId]="collectionId"
    (documentoCreato)="onDocumentoCreato()"
    (chiudi)="showModalNewDoc.set(false)"
  ></app-add-document-modal>

  <app-upload-image-modal
    *ngIf="showModalLoadPict()"
    [collectionId]="collectionId"
    (chiudi)="showModalLoadPict.set(false)"
  ></app-upload-image-modal>
</div>
